# Gu√≠a de Orden de Ejecuci√≥n de Explotaciones - Desde M√°quina Local

Esta gu√≠a describe el orden recomendado para ejecutar las explotaciones desde tu m√°quina local.

## üéØ Opci√≥n 1: Script Autom√°tico Completo (Recomendado)

El script m√°s completo que ejecuta todas las fases autom√°ticamente:

```bash
cd exploitation
chmod +x attack-from-local.sh
./attack-from-local.sh
```

**Este script ejecuta autom√°ticamente:**
1. Reconocimiento inicial
2. Explotaci√≥n de aplicaciones web
3. Explotaci√≥n de API
4. Acceso a aplicaci√≥n legacy
5. Explotaci√≥n avanzada
6. Aplicaciones adicionales (blog, e-commerce, voting)
7. Escalaci√≥n de privilegios en la nube (IAM role) - requiere BASTION_IP

**Ventajas:** Todo automatizado, ejecuta en orden correcto, con delays realistas

---

## üîß Opci√≥n 2: Ejecuci√≥n Manual Paso a Paso

Si prefieres ejecutar cada fase manualmente para mayor control:

### Fase 1: Reconocimiento e Informaci√≥n

```bash
cd exploitation

# 1.1 Verificar accesibilidad de servicios
export WEB_URL="http://af27f94ff0dd5475abf27381998b12fc-2136651876.eu-central-1.elb.amazonaws.com:3000"
export API_URL="http://a98f78674a87c490fb96ee76715e9518-288516544.eu-central-1.elb.amazonaws.com:5000"
export LEGACY_URL="http://a88e2ebd02375423d87211a4aaef867d-356569397.eu-central-1.elb.amazonaws.com:8080"

# Verificar que los servicios responden
curl -s -o /dev/null -w "%{http_code}" --max-time 5 "$WEB_URL" 
curl -s -o /dev/null -w "%{http_code}" --max-time 5 "$API_URL"
curl -s -o /dev/null -w "%{http_code}" --max-time 5 "$LEGACY_URL"

# 1.2 Obtener informaci√≥n del debug endpoint
curl -s "$WEB_URL/debug" | jq .
```

### Fase 2: Explotaci√≥n de Aplicaci√≥n Web

```bash
chmod +x exploit-web-app.sh
./exploit-web-app.sh "$WEB_URL"
```

**Vulnerabilidades explotadas:**
- XSS (Cross-Site Scripting)
- SQL Injection
- Path Traversal
- Command Injection
- Information Disclosure

### Fase 3: Explotaci√≥n de API

```bash
chmod +x exploit-api.sh
./exploit-api.sh "$API_URL"
```

**Vulnerabilidades explotadas:**
- Unsafe Deserialization (pickle)
- YAML Deserialization
- Command Injection
- Path Traversal
- SSRF
- Weak Authentication

### Fase 4: Explotaci√≥n de Voting App

```bash
export VOTING_URL="http://ad8512b5692d9457da88ce9329cd97c6-1574672033.eu-central-1.elb.amazonaws.com:8080"

chmod +x exploit-voting-app.sh
./exploit-voting-app.sh "$VOTING_URL"
```

**Vulnerabilidades explotadas:**
- SQL Injection (m√∫ltiples endpoints)
- XSS en comentarios
- Path Traversal
- Command Injection
- Insecure Deserialization
- Weak Authentication
- Arbitrary SQL Execution

### Fase 5: Acceso a Aplicaci√≥n Legacy

```bash
curl -s "$LEGACY_URL" | head -20
# La aplicaci√≥n legacy puede tener vulnerabilidades de Java/Tomcat
```

### Fase 6: Explotaci√≥n de Base de Datos

```bash
chmod +x exploit-database.sh
# Necesitar√°s la IP del LoadBalancer de la base de datos
export DB_HOST="a748cd2bdc0324656a0780a31f5f7bbb-497451209.eu-central-1.elb.amazonaws.com"
./exploit-database.sh "$DB_HOST" 3306
```

### Fase 7: Escalaci√≥n de Privilegios en la Nube (IAM Role)

**Nota:** Esta fase requiere acceso al bastion para ejecutar el script.

```bash
# Opci√≥n A: Ejecutar desde el bastion (recomendado)
export BASTION_IP="3.124.143.227"  # Tu IP del bastion
ssh -p 22222 ubuntu@$BASTION_IP "cd ~/exploitation && ./exploit-iam-role.sh"

# Opci√≥n B: Ejecutar desde local si tienes las credenciales configuradas
chmod +x exploit-iam-role.sh
export EXPLOITATION_ROLE_ARN="arn:aws:iam::203918880757:role/exploitation-admin-role"
./exploit-iam-role.sh
```

**Acciones realizadas:**
- Asume el rol IAM con permisos excesivos
- Descarga archivo EICAR (simulaci√≥n de malware)
- Crea usuario IAM adicional para reconocimiento
- Realiza reconocimiento en la nube (IAM, EC2, S3, EKS, Lambda, RDS)

---

## üìã Orden Recomendado Completo

### Desde tu M√°quina Local:

```bash
# 1. Configurar variables de entorno
export WEB_URL="http://af27f94ff0dd5475abf27381998b12fc-2136651876.eu-central-1.elb.amazonaws.com:3000"
export API_URL="http://a98f78674a87c490fb96ee76715e9518-288516544.eu-central-1.elb.amazonaws.com:5000"
export LEGACY_URL="http://a88e2ebd02375423d87211a4aaef867d-356569397.eu-central-1.elb.amazonaws.com:8080"
export VOTING_URL="http://ad8512b5692d9457da88ce9329cd97c6-1574672033.eu-central-1.elb.amazonaws.com:8080"
export BASTION_IP="3.124.143.227"  # Tu IP del bastion

cd exploitation

# 2. Ejecutar script completo autom√°tico (RECOMENDADO)
chmod +x attack-from-local.sh
./attack-from-local.sh

# O ejecutar manualmente paso a paso:

# 3. Reconocimiento
curl -s "$WEB_URL/debug" | jq .

# 4. Explotaci√≥n Web App
chmod +x exploit-web-app.sh
./exploit-web-app.sh "$WEB_URL"

# 5. Explotaci√≥n API
chmod +x exploit-api.sh
./exploit-api.sh "$API_URL"

# 6. Explotaci√≥n Voting App
chmod +x exploit-voting-app.sh
./exploit-voting-app.sh "$VOTING_URL"

# 7. Explotaci√≥n Database
chmod +x exploit-database.sh
./exploit-database.sh "a748cd2bdc0324656a0780a31f5f7bbb-497451209.eu-central-1.elb.amazonaws.com" 3306

# 8. Escalaci√≥n IAM (desde bastion)
ssh -p 22222 ubuntu@$BASTION_IP "cd ~/exploitation && ./exploit-iam-role.sh"
```

---

## üé¨ Scripts Disponibles y su Prop√≥sito

### Scripts Principales (Desde Local):

1. **`attack-from-local.sh`** ‚≠ê **RECOMENDADO**
   - Script completo que ejecuta todas las fases
   - Usa LoadBalancer URLs directamente
   - Ejecuta ataques gradualmente

2. **`complete-attack-chain.sh`**
   - Cadena completa de ataques secuenciales
   - Similar a attack-from-local.sh pero con estructura diferente

### Scripts Individuales:

3. **`exploit-web-app.sh <URL>`**
   - Explota vulnerabilidades de la aplicaci√≥n web
   - XSS, SQL Injection, Path Traversal, Command Injection

4. **`exploit-api.sh <URL>`**
   - Explota vulnerabilidades de la API
   - Deserialization, SSRF, Command Injection

5. **`exploit-voting-app.sh <URL>`**
   - Explota vulnerabilidades de la aplicaci√≥n de votaci√≥n
   - SQL Injection, XSS, Command Injection, Weak Auth

6. **`exploit-database.sh <HOST> <PORT>`**
   - Explota base de datos con credenciales d√©biles
   - Dump de datos, enumeraci√≥n

7. **`exploit-iam-role.sh`**
   - Explota rol IAM con permisos excesivos
   - Asume rol, crea usuario, reconocimiento en la nube

### Scripts Avanzados (Requieren acceso al cluster):

8. **`lateral-movement.sh`**
   - Movimiento lateral desde bastion al cluster
   - Descarga EICAR, configura kubectl

9. **`exploit-k8s.sh <NAMESPACE>`**
   - Explota vulnerabilidades de Kubernetes
   - Enumera recursos, explota permisos

10. **`enumerate-resources.sh`**
    - Enumera recursos del cluster
    - Pods, servicios, configmaps, secrets

---

## ‚ö° Ejecuci√≥n R√°pida (Todo en Uno)

```bash
cd exploitation

# Configurar URLs (opcional, tiene defaults)
export BASTION_IP="3.124.143.227"

# Ejecutar todo autom√°ticamente
chmod +x attack-from-local.sh
./attack-from-local.sh
```

Este script ejecutar√° todas las fases en el orden correcto con delays realistas.

---

## üìä Flujo de Ataque Recomendado

```
1. Reconocimiento
   ‚îî‚îÄ> Verificar servicios accesibles
   ‚îî‚îÄ> Obtener informaci√≥n de debug endpoints
   
2. Explotaci√≥n de Aplicaciones Web
   ‚îî‚îÄ> vulnerable-web-app (XSS, SQLi, Path Traversal)
   ‚îî‚îÄ> vulnerable-api (Deserialization, SSRF)
   ‚îî‚îÄ> voting-app (SQLi, XSS, Command Injection)
   
3. Explotaci√≥n de Base de Datos
   ‚îî‚îÄ> Acceso con credenciales d√©biles
   ‚îî‚îÄ> Dump de datos sensibles
   
4. Movimiento Lateral (Opcional, desde bastion)
   ‚îî‚îÄ> Acceso al cluster Kubernetes
   ‚îî‚îÄ> Explotaci√≥n de recursos K8s
   
5. Escalaci√≥n de Privilegios en la Nube
   ‚îî‚îÄ> Asumir rol IAM con permisos excesivos
   ‚îî‚îÄ> Crear usuario adicional
   ‚îî‚îÄ> Reconocimiento en la nube (IAM, EC2, S3, EKS, etc.)
```

---

## üõë C√≥mo Detener las Explotaciones

Si ejecutaste scripts en background o quieres detener procesos:

```bash
# Detener todos los scripts de explotaci√≥n
pkill -f exploit-
pkill -f attack-from-local
pkill -f complete-attack-chain

# Verificar procesos corriendo
ps aux | grep exploit
```

---

## üìù Notas Importantes

1. **URLs por defecto:** Los scripts tienen URLs por defecto, pero puedes sobrescribirlas con variables de entorno
2. **Delays:** Los scripts incluyen delays entre ataques para simular comportamiento realista
3. **Bastion IP:** Algunas fases requieren acceso al bastion (escalaci√≥n IAM)
4. **LoadBalancers:** Todas las aplicaciones est√°n expuestas v√≠a LoadBalancer para acceso directo
5. **Tr√°fico leg√≠timo:** El generador de tr√°fico leg√≠timo ayuda a ocultar el tr√°fico de ataque

---

## üîó URLs de las Aplicaciones

```bash
# Vulnerable Web App
http://af27f94ff0dd5475abf27381998b12fc-2136651876.eu-central-1.elb.amazonaws.com:3000

# Vulnerable API
http://a98f78674a87c490fb96ee76715e9518-288516544.eu-central-1.elb.amazonaws.com:5000

# Vulnerable Legacy App
http://a88e2ebd02375423d87211a4aaef867d-356569397.eu-central-1.elb.amazonaws.com:8080

# Blog App
http://a8e30c27f440045a190fb51d1fd10062-1007446821.eu-central-1.elb.amazonaws.com:8081

# E-commerce App
http://ac9c51258fda44a149fb400ec24e8d02-1766768.eu-central-1.elb.amazonaws.com:8082

# Voting App
http://ad8512b5692d9457da88ce9329cd97c6-1574672033.eu-central-1.elb.amazonaws.com:8080

# Database (MySQL)
a748cd2bdc0324656a0780a31f5f7bbb-497451209.eu-central-1.elb.amazonaws.com:3306
```

---

## ‚úÖ Checklist de Ejecuci√≥n

- [ ] Verificar que los servicios est√°n accesibles
- [ ] Ejecutar reconocimiento inicial
- [ ] Explotar vulnerable-web-app
- [ ] Explotar vulnerable-api
- [ ] Explotar voting-app
- [ ] Explotar base de datos
- [ ] (Opcional) Movimiento lateral desde bastion
- [ ] Escalar privilegios IAM desde bastion
- [ ] Realizar reconocimiento en la nube

